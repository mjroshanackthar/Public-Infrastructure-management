{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\locha\\\\Downloads\\\\BC_Backend_part\\\\Frontend_part\\\\src\\\\contexts\\\\ContractorContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { contractorsAPI } from '../services/api';\nimport { useAuth, PERMISSIONS } from './AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ContractorContext = /*#__PURE__*/createContext();\nexport const useContractors = () => {\n  _s();\n  const context = useContext(ContractorContext);\n  if (!context) {\n    throw new Error('useContractors must be used within a ContractorProvider');\n  }\n  return context;\n};\n_s(useContractors, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const ContractorProvider = ({\n  children\n}) => {\n  _s2();\n  const [contractors, setContractors] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const {\n    user,\n    refreshUser,\n    hasPermission\n  } = useAuth();\n\n  // Load contractors data (only if user has permission)\n  const loadContractors = async () => {\n    if (!hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\n      console.log('User does not have permission to view contractors');\n      setContractors([]);\n      return;\n    }\n    try {\n      setLoading(true);\n      const response = await contractorsAPI.getAllContractors();\n      setContractors(Array.isArray(response.data) ? response.data : []);\n      setLastUpdated(new Date());\n    } catch (error) {\n      var _error$response;\n      console.error('Failed to load contractors:', error);\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 403) {\n        console.log('Access denied to contractor information');\n      }\n      setContractors([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Update a specific contractor's verification status\n  const updateContractorStatus = async (contractorId, isVerified) => {\n    try {\n      // Update in backend\n      const response = await fetch(`http://localhost:5002/api/contractors/${contractorId}/verification-status`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`\n        },\n        body: JSON.stringify({\n          isVerified,\n          verificationNotes: `Status changed to ${isVerified ? 'verified' : 'unverified'} by verifier`\n        })\n      });\n      if (response.ok) {\n        // Update local state immediately\n        setContractors(prev => prev.map(contractor => contractor._id === contractorId ? {\n          ...contractor,\n          isVerified\n        } : contractor));\n\n        // If the current user is the contractor being updated, refresh their data\n        if ((user === null || user === void 0 ? void 0 : user._id) === contractorId) {\n          await refreshUser();\n        }\n\n        // Reload all contractors to ensure consistency\n        await loadContractors();\n        return {\n          success: true\n        };\n      } else {\n        const data = await response.json();\n        throw new Error(data.message || 'Failed to update status');\n      }\n    } catch (error) {\n      console.error('Error updating contractor status:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  };\n\n  // Get contractor by ID\n  const getContractor = contractorId => {\n    return contractors.find(c => c._id === contractorId);\n  };\n\n  // Get verification statistics\n  const getStats = () => {\n    return {\n      total: contractors.length,\n      verified: contractors.filter(c => c.isVerified).length,\n      unverified: contractors.filter(c => !c.isVerified).length\n    };\n  };\n\n  // Auto-refresh every 30 seconds - only for users with contractor view permission\n  useEffect(() => {\n    let interval;\n    if (user && hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\n      interval = setInterval(() => {\n        loadContractors();\n      }, 30000);\n    }\n    return () => {\n      if (interval) {\n        clearInterval(interval);\n      }\n    };\n  }, [user, hasPermission]);\n\n  // Initial load - only for users who have permission to view contractor data\n  useEffect(() => {\n    if (user && hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\n      loadContractors();\n    }\n  }, [user, hasPermission]);\n  const value = {\n    contractors,\n    loading,\n    lastUpdated,\n    loadContractors,\n    updateContractorStatus,\n    getContractor,\n    getStats\n  };\n  return /*#__PURE__*/_jsxDEV(ContractorContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n};\n_s2(ContractorProvider, \"L19Lyrs13pJS7ly59C+BPr5SEOk=\", false, function () {\n  return [useAuth];\n});\n_c = ContractorProvider;\nvar _c;\n$RefreshReg$(_c, \"ContractorProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","contractorsAPI","useAuth","PERMISSIONS","jsxDEV","_jsxDEV","ContractorContext","useContractors","_s","context","Error","ContractorProvider","children","_s2","contractors","setContractors","loading","setLoading","lastUpdated","setLastUpdated","user","refreshUser","hasPermission","loadContractors","VIEW_CONTRACTORS","console","log","response","getAllContractors","Array","isArray","data","Date","error","_error$response","status","updateContractorStatus","contractorId","isVerified","fetch","method","headers","localStorage","getItem","body","JSON","stringify","verificationNotes","ok","prev","map","contractor","_id","success","json","message","getContractor","find","c","getStats","total","length","verified","filter","unverified","interval","setInterval","clearInterval","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/locha/Downloads/BC_Backend_part/Frontend_part/src/contexts/ContractorContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { contractorsAPI } from '../services/api';\r\nimport { useAuth, PERMISSIONS } from './AuthContext';\r\n\r\nconst ContractorContext = createContext();\r\n\r\nexport const useContractors = () => {\r\n  const context = useContext(ContractorContext);\r\n  if (!context) {\r\n    throw new Error('useContractors must be used within a ContractorProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ContractorProvider = ({ children }) => {\r\n  const [contractors, setContractors] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [lastUpdated, setLastUpdated] = useState(null);\r\n  const { user, refreshUser, hasPermission } = useAuth();\r\n\r\n  // Load contractors data (only if user has permission)\r\n  const loadContractors = async () => {\r\n    if (!hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\r\n      console.log('User does not have permission to view contractors');\r\n      setContractors([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await contractorsAPI.getAllContractors();\r\n      setContractors(Array.isArray(response.data) ? response.data : []);\r\n      setLastUpdated(new Date());\r\n    } catch (error) {\r\n      console.error('Failed to load contractors:', error);\r\n      if (error.response?.status === 403) {\r\n        console.log('Access denied to contractor information');\r\n      }\r\n      setContractors([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Update a specific contractor's verification status\r\n  const updateContractorStatus = async (contractorId, isVerified) => {\r\n    try {\r\n      // Update in backend\r\n      const response = await fetch(`http://localhost:5002/api/contractors/${contractorId}/verification-status`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`\r\n        },\r\n        body: JSON.stringify({\r\n          isVerified,\r\n          verificationNotes: `Status changed to ${isVerified ? 'verified' : 'unverified'} by verifier`\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        // Update local state immediately\r\n        setContractors(prev => \r\n          prev.map(contractor => \r\n            contractor._id === contractorId \r\n              ? { ...contractor, isVerified }\r\n              : contractor\r\n          )\r\n        );\r\n\r\n        // If the current user is the contractor being updated, refresh their data\r\n        if (user?._id === contractorId) {\r\n          await refreshUser();\r\n        }\r\n\r\n        // Reload all contractors to ensure consistency\r\n        await loadContractors();\r\n\r\n        return { success: true };\r\n      } else {\r\n        const data = await response.json();\r\n        throw new Error(data.message || 'Failed to update status');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating contractor status:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Get contractor by ID\r\n  const getContractor = (contractorId) => {\r\n    return contractors.find(c => c._id === contractorId);\r\n  };\r\n\r\n  // Get verification statistics\r\n  const getStats = () => {\r\n    return {\r\n      total: contractors.length,\r\n      verified: contractors.filter(c => c.isVerified).length,\r\n      unverified: contractors.filter(c => !c.isVerified).length\r\n    };\r\n  };\r\n\r\n  // Auto-refresh every 30 seconds - only for users with contractor view permission\r\n  useEffect(() => {\r\n    let interval;\r\n    if (user && hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\r\n      interval = setInterval(() => {\r\n        loadContractors();\r\n      }, 30000);\r\n    }\r\n\r\n    return () => {\r\n      if (interval) {\r\n        clearInterval(interval);\r\n      }\r\n    };\r\n  }, [user, hasPermission]);\r\n\r\n  // Initial load - only for users who have permission to view contractor data\r\n  useEffect(() => {\r\n    if (user && hasPermission(PERMISSIONS.VIEW_CONTRACTORS)) {\r\n      loadContractors();\r\n    }\r\n  }, [user, hasPermission]);\r\n\r\n  const value = {\r\n    contractors,\r\n    loading,\r\n    lastUpdated,\r\n    loadContractors,\r\n    updateContractorStatus,\r\n    getContractor,\r\n    getStats\r\n  };\r\n\r\n  return (\r\n    <ContractorContext.Provider value={value}>\r\n      {children}\r\n    </ContractorContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}