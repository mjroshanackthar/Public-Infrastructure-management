{"ast":null,"code":"import { ethers } from 'ethers';\n\n// This will be updated after contract deployment\n// Check Backend_part/contract-address.json after running deployment script\nconst CONTRACT_ADDRESS = process.env.REACT_APP_CONTRACT_ADDRESS || '0x5FbDB2315678afecb367f032d93F642f64180aa3';\n\n// ABI for TenderPayment contract\nconst TENDER_PAYMENT_ABI = [\"event PaymentProcessed(uint256 indexed tenderId, address indexed contractor, uint256 amount, uint256 timestamp)\", \"function processPayment(uint256 tenderId, address payable contractor) external payable\", \"function payments(uint256) external view returns (uint256 tenderId, address contractor, uint256 amount, uint256 timestamp, bool processed)\"];\nexport const getContract = signerOrProvider => {\n  return new ethers.Contract(CONTRACT_ADDRESS, TENDER_PAYMENT_ABI, signerOrProvider);\n};\nexport const processPaymentViaContract = async (signer, tenderId, contractorAddress, amountInEth) => {\n  try {\n    console.log('ðŸ”„ Processing payment via smart contract...');\n    console.log('Tender ID:', tenderId);\n    console.log('Contractor:', contractorAddress);\n    console.log('Amount:', amountInEth, 'ETH');\n    const contract = getContract(signer);\n\n    // Convert amount to Wei\n    const amountInWei = ethers.parseEther(amountInEth.toString());\n\n    // Send transaction\n    const tx = await contract.processPayment(tenderId, contractorAddress, {\n      value: amountInWei\n    });\n    console.log('ðŸ“¤ Transaction sent:', tx.hash);\n\n    // Wait for confirmation\n    const receipt = await tx.wait();\n    console.log('âœ… Transaction confirmed in block:', receipt.blockNumber);\n    return {\n      success: true,\n      hash: tx.hash,\n      receipt,\n      blockNumber: receipt.blockNumber\n    };\n  } catch (error) {\n    console.error('âŒ Contract interaction failed:', error);\n    return {\n      success: false,\n      error: error.message,\n      code: error.code\n    };\n  }\n};\nexport const sendDirectPayment = async (signer, toAddress, amountInEth) => {\n  try {\n    console.log('ðŸ”„ Sending direct ETH transfer...');\n    console.log('To:', toAddress);\n    console.log('Amount:', amountInEth, 'ETH');\n    const tx = await signer.sendTransaction({\n      to: toAddress,\n      value: ethers.parseEther(amountInEth.toString())\n    });\n    console.log('ðŸ“¤ Transaction sent:', tx.hash);\n    const receipt = await tx.wait();\n    console.log('âœ… Transaction confirmed in block:', receipt.blockNumber);\n    return {\n      success: true,\n      hash: tx.hash,\n      receipt,\n      blockNumber: receipt.blockNumber\n    };\n  } catch (error) {\n    console.error('âŒ Payment failed:', error);\n    return {\n      success: false,\n      error: error.message,\n      code: error.code\n    };\n  }\n};\nexport const getPaymentHistory = async (provider, tenderId) => {\n  try {\n    const contract = getContract(provider);\n    const payment = await contract.payments(tenderId);\n    return {\n      tenderId: payment.tenderId.toString(),\n      contractor: payment.contractor,\n      amount: ethers.formatEther(payment.amount),\n      timestamp: new Date(Number(payment.timestamp) * 1000).toISOString(),\n      processed: payment.processed\n    };\n  } catch (error) {\n    console.error('Failed to fetch payment:', error);\n    return null;\n  }\n};\nexport const getBalance = async (provider, address) => {\n  try {\n    const balance = await provider.getBalance(address);\n    return ethers.formatEther(balance);\n  } catch (error) {\n    console.error('Failed to get balance:', error);\n    return '0';\n  }\n};\nexport const listenToPaymentEvents = (provider, callback) => {\n  const contract = getContract(provider);\n  contract.on('PaymentProcessed', (tenderId, contractor, amount, timestamp, event) => {\n    callback({\n      tenderId: tenderId.toString(),\n      contractor,\n      amount: ethers.formatEther(amount),\n      timestamp: new Date(Number(timestamp) * 1000).toISOString(),\n      transactionHash: event.log.transactionHash,\n      blockNumber: event.log.blockNumber\n    });\n  });\n\n  // Return cleanup function\n  return () => {\n    contract.removeAllListeners('PaymentProcessed');\n  };\n};\nexport const CONTRACT_INFO = {\n  address: CONTRACT_ADDRESS,\n  network: 'Hardhat Local',\n  chainId: 31337\n};","map":{"version":3,"names":["ethers","CONTRACT_ADDRESS","process","env","REACT_APP_CONTRACT_ADDRESS","TENDER_PAYMENT_ABI","getContract","signerOrProvider","Contract","processPaymentViaContract","signer","tenderId","contractorAddress","amountInEth","console","log","contract","amountInWei","parseEther","toString","tx","processPayment","value","hash","receipt","wait","blockNumber","success","error","message","code","sendDirectPayment","toAddress","sendTransaction","to","getPaymentHistory","provider","payment","payments","contractor","amount","formatEther","timestamp","Date","Number","toISOString","processed","getBalance","address","balance","listenToPaymentEvents","callback","on","event","transactionHash","removeAllListeners","CONTRACT_INFO","network","chainId"],"sources":["C:/Users/locha/Downloads/BC_Backend_part/Frontend_part/src/services/contractService.js"],"sourcesContent":["import { ethers } from 'ethers';\r\n\r\n// This will be updated after contract deployment\r\n// Check Backend_part/contract-address.json after running deployment script\r\nconst CONTRACT_ADDRESS = process.env.REACT_APP_CONTRACT_ADDRESS || '0x5FbDB2315678afecb367f032d93F642f64180aa3';\r\n\r\n// ABI for TenderPayment contract\r\nconst TENDER_PAYMENT_ABI = [\r\n  \"event PaymentProcessed(uint256 indexed tenderId, address indexed contractor, uint256 amount, uint256 timestamp)\",\r\n  \"function processPayment(uint256 tenderId, address payable contractor) external payable\",\r\n  \"function payments(uint256) external view returns (uint256 tenderId, address contractor, uint256 amount, uint256 timestamp, bool processed)\"\r\n];\r\n\r\nexport const getContract = (signerOrProvider) => {\r\n  return new ethers.Contract(CONTRACT_ADDRESS, TENDER_PAYMENT_ABI, signerOrProvider);\r\n};\r\n\r\nexport const processPaymentViaContract = async (signer, tenderId, contractorAddress, amountInEth) => {\r\n  try {\r\n    console.log('ðŸ”„ Processing payment via smart contract...');\r\n    console.log('Tender ID:', tenderId);\r\n    console.log('Contractor:', contractorAddress);\r\n    console.log('Amount:', amountInEth, 'ETH');\r\n\r\n    const contract = getContract(signer);\r\n    \r\n    // Convert amount to Wei\r\n    const amountInWei = ethers.parseEther(amountInEth.toString());\r\n    \r\n    // Send transaction\r\n    const tx = await contract.processPayment(\r\n      tenderId,\r\n      contractorAddress,\r\n      { value: amountInWei }\r\n    );\r\n\r\n    console.log('ðŸ“¤ Transaction sent:', tx.hash);\r\n    \r\n    // Wait for confirmation\r\n    const receipt = await tx.wait();\r\n    console.log('âœ… Transaction confirmed in block:', receipt.blockNumber);\r\n\r\n    return { \r\n      success: true, \r\n      hash: tx.hash, \r\n      receipt,\r\n      blockNumber: receipt.blockNumber\r\n    };\r\n  } catch (error) {\r\n    console.error('âŒ Contract interaction failed:', error);\r\n    return { \r\n      success: false, \r\n      error: error.message,\r\n      code: error.code\r\n    };\r\n  }\r\n};\r\n\r\nexport const sendDirectPayment = async (signer, toAddress, amountInEth) => {\r\n  try {\r\n    console.log('ðŸ”„ Sending direct ETH transfer...');\r\n    console.log('To:', toAddress);\r\n    console.log('Amount:', amountInEth, 'ETH');\r\n\r\n    const tx = await signer.sendTransaction({\r\n      to: toAddress,\r\n      value: ethers.parseEther(amountInEth.toString())\r\n    });\r\n\r\n    console.log('ðŸ“¤ Transaction sent:', tx.hash);\r\n    \r\n    const receipt = await tx.wait();\r\n    console.log('âœ… Transaction confirmed in block:', receipt.blockNumber);\r\n\r\n    return { \r\n      success: true, \r\n      hash: tx.hash, \r\n      receipt,\r\n      blockNumber: receipt.blockNumber\r\n    };\r\n  } catch (error) {\r\n    console.error('âŒ Payment failed:', error);\r\n    return { \r\n      success: false, \r\n      error: error.message,\r\n      code: error.code\r\n    };\r\n  }\r\n};\r\n\r\nexport const getPaymentHistory = async (provider, tenderId) => {\r\n  try {\r\n    const contract = getContract(provider);\r\n    const payment = await contract.payments(tenderId);\r\n    \r\n    return {\r\n      tenderId: payment.tenderId.toString(),\r\n      contractor: payment.contractor,\r\n      amount: ethers.formatEther(payment.amount),\r\n      timestamp: new Date(Number(payment.timestamp) * 1000).toISOString(),\r\n      processed: payment.processed\r\n    };\r\n  } catch (error) {\r\n    console.error('Failed to fetch payment:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const getBalance = async (provider, address) => {\r\n  try {\r\n    const balance = await provider.getBalance(address);\r\n    return ethers.formatEther(balance);\r\n  } catch (error) {\r\n    console.error('Failed to get balance:', error);\r\n    return '0';\r\n  }\r\n};\r\n\r\nexport const listenToPaymentEvents = (provider, callback) => {\r\n  const contract = getContract(provider);\r\n  \r\n  contract.on('PaymentProcessed', (tenderId, contractor, amount, timestamp, event) => {\r\n    callback({\r\n      tenderId: tenderId.toString(),\r\n      contractor,\r\n      amount: ethers.formatEther(amount),\r\n      timestamp: new Date(Number(timestamp) * 1000).toISOString(),\r\n      transactionHash: event.log.transactionHash,\r\n      blockNumber: event.log.blockNumber\r\n    });\r\n  });\r\n\r\n  // Return cleanup function\r\n  return () => {\r\n    contract.removeAllListeners('PaymentProcessed');\r\n  };\r\n};\r\n\r\nexport const CONTRACT_INFO = {\r\n  address: CONTRACT_ADDRESS,\r\n  network: 'Hardhat Local',\r\n  chainId: 31337\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}